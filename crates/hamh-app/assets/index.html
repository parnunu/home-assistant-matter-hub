<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HAMH Rework</title>
    <link rel="stylesheet" href="/styles.css?v=9" />
  </head>
  <body>
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>

    <div class="app">
      <header class="topbar">
        <div class="brand">
          <div class="brand-mark">H</div>
          <div>
            <div class="brand-title">HAMH Rework</div>
            <div class="brand-subtitle">Rust Matter Hub - local admin</div>
          </div>
        </div>
        <div class="topbar-actions">
          <div id="statusPill" class="status-pill">Checking backend...</div>
          <button id="refreshAll" class="btn btn-ghost">Refresh</button>
        </div>
      </header>

      <main class="layout">
        <section id="viewList" class="panel">
          <div class="panel-header">
            <div>
              <h2>Bridges</h2>
              <p class="muted">Quick overview of configured bridges.</p>
            </div>
            <div class="panel-actions">
              <button id="goCreate" class="btn btn-primary">Add bridge</button>
            </div>
          </div>
          <div id="bridgeEmpty" class="empty">No bridges yet. Create one to get started.</div>
          <div id="bridgeList" class="bridge-list"></div>
        </section>

        <section id="viewCreate" class="panel hidden">
          <div class="panel-header">
            <div>
              <h2>Create Bridge</h2>
              <p class="muted">Define a bridge and choose what Home Assistant entities to expose.</p>
            </div>
            <div class="panel-actions">
              <button id="backToListFromCreate" class="btn btn-ghost">Back to list</button>
              <button id="clearFilters" class="btn btn-ghost">Clear filters</button>
            </div>
          </div>

          <form id="createForm" class="form-grid">
            <label>
              Name
              <input type="text" id="bridgeName" placeholder="Living Room" required />
            </label>
            <label>
              Port
              <input type="number" id="bridgePort" min="1024" max="65535" value="5540" required />
            </label>

            <label class="full">
              Include filters
              <div class="filter-row">
                <select id="includeType">
                  <option value="pattern">pattern</option>
                  <option value="domain">domain</option>
                  <option value="platform">platform</option>
                  <option value="entity_category">entity_category</option>
                  <option value="label">label</option>
                  <option value="area">area</option>
                  <option value="entity_id">entity_id</option>
                  <option value="device_id">device_id</option>
                </select>
                <input type="text" id="includeValue" placeholder="light.* or kitchen" />
                <button type="button" id="addInclude" class="btn btn-ghost">Add</button>
              </div>
              <div id="includeList" class="pill-list"></div>
            </label>

            <label class="full">
              Exclude filters
              <div class="filter-row">
                <select id="excludeType">
                  <option value="pattern">pattern</option>
                  <option value="domain">domain</option>
                  <option value="platform">platform</option>
                  <option value="entity_category">entity_category</option>
                  <option value="label">label</option>
                  <option value="area">area</option>
                  <option value="entity_id">entity_id</option>
                  <option value="device_id">device_id</option>
                </select>
                <input type="text" id="excludeValue" placeholder="sensor.*" />
                <button type="button" id="addExclude" class="btn btn-ghost">Add</button>
              </div>
              <div id="excludeList" class="pill-list"></div>
            </label>

            <label class="checkbox full">
              <input type="checkbox" id="coverInvert" />
              Cover: do not invert percentage
            </label>

            <div class="full">
              <button class="btn btn-primary" type="submit">Create bridge</button>
            </div>
          </form>
        </section>

        <section id="viewDetails" class="panel hidden">
          <div class="panel-header">
            <div>
              <h2>Bridge details</h2>
              <p id="detailsSubtitle" class="muted">Bridge summary and device list.</p>
            </div>
            <div class="panel-actions">
              <button id="backToListFromDetails" class="btn btn-ghost">Back to list</button>
              <button id="editBridge" class="btn btn-ghost">Edit</button>
            </div>
          </div>
          <div id="detailsCard" class="bridge-card"></div>

          <div class="section-header">
            <h3>Configuration</h3>
          </div>
          <div id="configSummary" class="config-summary"></div>

          <div class="section-header">
            <h3>Devices</h3>
            <div class="panel-actions">
              <button id="refreshDevices" class="btn btn-ghost">Refresh devices</button>
            </div>
          </div>
          <div id="devicesEmpty" class="empty">No devices mapped yet.</div>
          <div id="deviceList" class="device-list"></div>

          <div class="section-header">
            <h3>Pairing</h3>
          </div>
          <div id="pairingEmpty" class="empty">Pairing info not available.</div>
          <div id="pairingCard" class="pairing-card hidden">
            <div class="pairing-row">
              <div>
                <div class="muted">QR text</div>
                <div id="pairingQrText" class="mono"></div>
              </div>
              <button id="copyQrText" class="btn btn-ghost">Copy</button>
            </div>
            <div class="pairing-row">
              <div>
                <div class="muted">Manual pairing code</div>
                <div id="pairingManual" class="mono"></div>
              </div>
              <button id="copyManual" class="btn btn-ghost">Copy</button>
            </div>
            <pre id="pairingQr" class="qr-box"></pre>
          </div>
        </section>

        <section id="viewEdit" class="panel hidden">
          <div class="panel-header">
            <div>
              <h2>Edit Bridge</h2>
              <p class="muted">Update name, port, or filters.</p>
            </div>
            <div class="panel-actions">
              <button id="backToDetails" class="btn btn-ghost">Back to details</button>
            </div>
          </div>

          <form id="editForm" class="form-grid">
            <label>
              Name
              <input type="text" id="editName" required />
            </label>
            <label>
              Port
              <input type="number" id="editPort" min="1024" max="65535" required />
            </label>

            <label class="full">
              Include filters
              <div class="filter-row">
                <select id="editIncludeType">
                  <option value="pattern">pattern</option>
                  <option value="domain">domain</option>
                  <option value="platform">platform</option>
                  <option value="entity_category">entity_category</option>
                  <option value="label">label</option>
                  <option value="area">area</option>
                  <option value="entity_id">entity_id</option>
                  <option value="device_id">device_id</option>
                </select>
                <input type="text" id="editIncludeValue" placeholder="light.*" />
                <button type="button" id="editAddInclude" class="btn btn-ghost">Add</button>
              </div>
              <div id="editIncludeList" class="pill-list"></div>
            </label>

            <label class="full">
              Exclude filters
              <div class="filter-row">
                <select id="editExcludeType">
                  <option value="pattern">pattern</option>
                  <option value="domain">domain</option>
                  <option value="platform">platform</option>
                  <option value="entity_category">entity_category</option>
                  <option value="label">label</option>
                  <option value="area">area</option>
                  <option value="entity_id">entity_id</option>
                  <option value="device_id">device_id</option>
                </select>
                <input type="text" id="editExcludeValue" placeholder="sensor.*" />
                <button type="button" id="editAddExclude" class="btn btn-ghost">Add</button>
              </div>
              <div id="editExcludeList" class="pill-list"></div>
            </label>

            <label class="checkbox full">
              <input type="checkbox" id="editCoverInvert" />
              Cover: do not invert percentage
            </label>

            <div class="full">
              <button class="btn btn-primary" type="submit">Save changes</button>
            </div>
          </form>
        </section>

        <section id="viewOps" class="panel collapsed">
          <div class="panel-header">
            <div>
              <h2>Operations</h2>
              <p class="muted">Recent actions queued and executed by the backend.</p>
            </div>
            <div class="panel-actions">
              <button id="toggleOps" class="btn btn-ghost">Show activity</button>
            </div>
          </div>
          <div id="opsBody" class="ops-body hidden">
            <div id="opsEmpty" class="empty">No operations yet.</div>
            <div class="table-wrap">
              <table class="table" id="opsTable">
                <thead>
                  <tr>
                    <th>Bridge</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Queued</th>
                    <th>Error</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script src="/app.js?v=9"></script>
  </body>
</html>
